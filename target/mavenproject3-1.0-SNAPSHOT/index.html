<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Survey</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <main class="page">
<img class="logo" src="images/murach-logo.jpg" alt="Murach Logo">
    <h1 class="title">Survey</h1>
    <p class="intro">
      If you have a moment, we'd appreciate it if you would fill out this survey.
    </p>

    <!-- Thêm onsubmit để gọi hàm kiểm tra -->
    <form action="survey" method="post" class="form" onsubmit="return validateVN(this)">

        
      <h2 class="section">Your information:</h2>

      <div class="row">
        <label for="firstName">First Name</label>
        <input id="firstName" name="firstName" type="text" required>
      </div>

      <div class="row">
        <label for="lastName">Last Name</label>
        <input id="lastName" name="lastName" type="text" required>
      </div>

      <div class="row">
        <label for="email">Email</label>
        <input id="email" name="email" type="email" required>
      </div>

      <div class="row">
        <label for="dob">Date of Birth</label>
        <input id="dob" name="dob" type="date" required>
      </div>

      <h2 class="section">How did you hear about us?</h2>
      <div class="choices">
        <label><input type="radio" name="hear" value="Search engine" checked> Search engine</label>
        <label><input type="radio" name="hear" value="Word of mouth"> Word of mouth</label>
        <label><input type="radio" name="hear" value="Social Media"> Social Media</label>
        <label><input type="radio" name="hear" value="Other"> Other</label>
      </div>

      <h2 class="section">Would you like to receive announcements about new CDs and special offers?</h2>
      <div class="choices">
        <label><input type="checkbox" name="offers" value="YES, I'd like that."> YES, I'd like that.</label>
        <label><input type="checkbox" name="emailoffers" value="YES, please send me email announcements."> YES, please send me email announcements.</label>
      </div>

      <div class="row">
        <label for="contact" class="wrap-label">Please contact<br>me by:</label>
        <select id="contact" name="contact">
          <option>Email or postal mail</option>
          <option>Email only</option>
          <option>Postal mail only</option>
        </select>
      </div>

      <button type="submit" class="submit">Submit</button>
    </form>
  </main>


<script>
  // Regex: chỉ cho phép chữ cái Unicode + khoảng trắng + ' . -
  const NAME_PATTERN = /^[\p{L}\s'.-]+$/u;
  // Regex: ký tự lặp liên tiếp >1 lần
  const REPEATED_CHAR = /([\p{L}])\1+/u;

  function validateVN(form) {
    const firstName = form.firstName.value.trim();
    const lastName  = form.lastName.value.trim();
    const dob       = form.dob.value;

    // 1) Kiểm tra ký tự hợp lệ
    if (!NAME_PATTERN.test(firstName)) {
      alert(`Họ "${firstName}" chỉ được gồm chữ (có thể có dấu), khoảng trắng và ',.-`);
      form.firstName.focus(); return false;
    }
    if (!NAME_PATTERN.test(lastName)) {
      alert(`Tên "${lastName}" chỉ được gồm chữ (có thể có dấu), khoảng trắng và ',.-`);
      form.lastName.focus(); return false;
    }

    // 2) Chặn ký tự lặp liên tiếp >1 lần
    if (REPEATED_CHAR.test(firstName)) {
      alert(`Họ "${firstName}" có ký tự lặp liên tiếp (ví dụ "aa", "ii"). Vui lòng nhập lại.`);
      form.firstName.focus(); return false;
    }
    if (REPEATED_CHAR.test(lastName)) {
      alert(`Tên "${lastName}" có ký tự lặp liên tiếp (ví dụ "aa", "ii"). Vui lòng nhập lại.`);
      form.lastName.focus(); return false;
    }

    // 3) Kiểm tra ngày sinh
    if (!dob) {
      alert("Vui lòng chọn Ngày sinh.");
      form.dob.focus(); return false;
    }

    const birthDate = new Date(dob);
    const today = new Date();
    today.setHours(0,0,0,0);

    if (birthDate > today) {
      alert("Ngày sinh không được sau ngày hiện tại.");
      form.dob.focus(); return false;
    }

    // Tính tuổi
    let age = today.getFullYear() - birthDate.getFullYear();
    const m = today.getMonth() - birthDate.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
      age--;
    }

    if (age > 120) {
      alert(`Tuổi tính từ ngày sinh "${dob}" là ${age}, vượt quá 120 tuổi. Vui lòng nhập lại.`);
      form.dob.focus(); return false;
    }

    return true; // hợp lệ
  }
</script>
</body>
</html>
